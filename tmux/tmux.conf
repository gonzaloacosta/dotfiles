# =====================================================================
# Bootstrap / Resets
# =====================================================================
# Load a separate reset file first (kept exactly as provided).
source-file ~/.config/tmux/tmux.reset.conf


# =====================================================================
# Terminal & Status Appearance
# =====================================================================
# Base default terminal advertised by tmux (commonly used by many setups).
set-option -g default-terminal 'screen-256color'

# Enable truecolor/24-bit color for xterm-256color terminals.
set-option -g terminal-overrides ',xterm-256color:RGB'

# Right side of the status bar: CloudFormation status, AWS info, CLI version, region, and Kubernetes context.
set-option -g status-right "#[fg=colour239,bg=colour178]AWS: #(~/.config/tmux/scripts/aws_account.sh) #[fg=colour239,bg=colour214]Region: #{aws_region} #[fg=colour239,bg=colour111]k8s: #(~/.config/tmux/scripts/kube_context.sh) "

# macOS style: place status bar at the top.
set -g status-position top

# Border styles for active/inactive panes.
set -g pane-active-border-style 'fg=magenta,bg=default'
set -g pane-border-style 'fg=brightblack,bg=default'

# Use vi-style keys in copy-mode.
setw -g mode-keys vi

# NOTE: This line overrides the earlier 'screen-256color' default-terminal,
# making tmux advertise whatever $TERM is in your environment. Kept as-is.
set -g default-terminal "${TERM}"


# =====================================================================
# Prefix, Behavior & History
# =====================================================================
# Set prefix to Ctrl-A (instead of default Ctrl-B).
set -g prefix ^A

# Window indexing starts at 1 (more natural numbering).
set -g base-index 1

# Do not kill tmux server when the last session is closed.
set -g detach-on-destroy off

# Remove escape delay for snappier key handling.
set -g escape-time 0

# Large scrollback history for panes.
set -g history-limit 1000000

# Renumber windows automatically when closing one.
set -g renumber-windows on

# Use the system clipboard for copy (where supported).
set -g set-clipboard on


# =====================================================================
# Custom Keybindings
# =====================================================================
# Window/pane navigation
bind-key w choose-tree -Zw  # Interactive window selector
bind-key W choose-tree -Zs  # Interactive session and window selector


# =====================================================================
# FZF-URL (Options Only)
# =====================================================================
# Custom FZF popup size and label when using URL opener plugins.
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="   " --border-label=" Open URL "'
# Limit URL history length.
set -g @fzf-url-history-limit '2000'


# =====================================================================
# Plugins (TPM) and Plugin Options
# =====================================================================
# Plugin manager
set -g @plugin 'tmux-plugins/tpm'

# Sensible defaults for tmux
set -g @plugin 'tmux-plugins/tmux-sensible'

# Better mouse behaviors (select, drag, etc.)
set -g @plugin 'nhdaly/tmux-better-mouse-mode'

# Open files/URLs directly
set -g @plugin 'tmux-plugins/tmux-open'

# Copy to system clipboard integrations
set -g @plugin 'tmux-plugins/tmux-yank'

# Pipe selections through fpp
set -g @plugin 'tmux-plugins/tmux-fpp'

# Enhanced searching (copycat)
set -g @plugin 'tmux-plugins/tmux-copycat'

# Persist/restore sessions
set -g @plugin 'tmux-plugins/tmux-resurrect'

# Continuously save/restore sessions
set -g @plugin 'tmux-plugins/tmux-continuum'

# Floating terminal helper
set -g @plugin 'lloydbond/tmux-floating-terminal'

# FZF helpers
set -g @plugin 'sainnhe/tmux-fzf'

# NOTE: Typo kept exactly as provided (tmux-pugins). Do not change per instructions.
# set -g @plugin 'tmux-pugins/tmuxp'

# AWS tmux status helpers
set -g @plugin 'darko-mesaros/aws-tmux'

# Alternative URL plugin (commented by you). Kept as-is.
# set -g @plugin 'wfxr/tmux-fzf-url'

# Catppuccin theme (your fork) + meetings script
set -g @plugin 'omerxx/catppuccin-tmux'

# Session manager UI
set -g @plugin 'omerxx/tmux-sessionx'

# Floating window helper (your fork naming)
set -g @plugin 'omerxx/tmux-floax'

# File explorer sidebar (Nvim-Tree/Neo-Tree in tmux)
set -g @plugin 'kiyoon/treemux'

# Floax plugin options (popup sizing/colors and binding)
set -g @floax-width '80%'
set -g @floax-height '80%'
set -g @floax-border-color 'magenta'
set -g @floax-text-color 'blue'
set -g @floax-bind 't'
set -g @floax-change-path 'true'

# Sessionx: bindings and behavior
set -g @sessionx-bind-zo-new-window 'ctrl-y'
set -g @sessionx-auto-accept 'off'
set -g @sessionx-custom-paths '/Users/gonzalo.acosta/dotfiles'
set -g @sessionx-bind '='
set -g @sessionx-x-path '~/dotfiles'
set -g @sessionx-window-height '85%'
set -g @sessionx-window-width '75%'
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-custom-paths-subdirectories 'false'
set -g @sessionx-filter-current 'false'

# Continuum + Resurrect integration
set -g @continuum-restore 'on'
set -g @resurrect-strategy-nvim 'session'

# Tmux-FZF keybinding (already installed)
set -g @tmux-fzf-launch-key 'C-f'

# Treemux configuration (file explorer sidebar)
set -g @treemux-tree-client 'neo-tree'
set -g @treemux-tree-nvim-init-file '~/.config/tmux/plugins/treemux/configs/treemux_init.lua'
set -g @treemux-tree-position 'left'
set -g @treemux-tree-width '35'
set -g @treemux-tree-focus 'smart'
set -g @treemux-bind 'E'


# =====================================================================
# Catppuccin Theme Options
# =====================================================================
# Window title separators and placements
set -g @catppuccin_window_left_separator ""
set -g @catppuccin_window_right_separator " "
set -g @catppuccin_window_middle_separator " █"
set -g @catppuccin_window_number_position "right"

# Window fill/text defaults
set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"

# Current window text (shows zoom flag icon)
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W#{?window_zoomed_flag,(),}"

# Status bar modules placement
set -g @catppuccin_status_modules_right "directory date_time"
set -g @catppuccin_status_modules_left "session"

# Status separators and fill
set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_right_separator " "
set -g @catppuccin_status_right_separator_inverse "no"
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"

# Directory text resolution and custom script for meetings
set -g @catppuccin_directory_text "#{b:pane_current_path}"
set -g @catppuccin_meetings_text "#($HOME/.config/tmux/scripts/cal.sh)"

# set -g @catppuccin_user_text "#($HOME/.config/tmux/scripts/aws_account.sh)"
# set -g @catppuccin_host_text "#($HOME/.config/tmux/scripts/kube_context.sh)"
#
# set -g @catppuccin_user_icon " "
# set -g @catppuccin_host_icon "󱃾 "

# Time format for status
set -g @catppuccin_date_time_text "%H:%M"


# =====================================================================
# TPM Bootstrap
# =====================================================================
# Initialize tmux plugin manager (TPM). Keep last.
run '~/.tmux/plugins/tpm/tpm'
